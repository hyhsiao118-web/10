<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº¬éƒ½ãƒ»å¤§é˜ªå†¬æ—¥æ—… - å¯¦æ™‚åŒæ­¥å…±äº«ç‰ˆ</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React, ReactDOM, Babel -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; margin: 0; padding: 0; background-color: #f8fafc; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .bg-gradient-header { background: linear-gradient(135deg, #1e1b4b 0%, #312e81 100%); }
        .timeline-dot { width: 14px; height: 14px; border-radius: 50%; background-color: #6366f1; border: 3px solid #e0e7ff; z-index: 10; }
        .timeline-dot-custom { width: 14px; height: 14px; border-radius: 50%; background-color: #10b981; border: 3px solid #d1fae5; z-index: 10; }
        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .scale-in { animation: scaleIn 0.2s ease-out; }
        @keyframes scaleIn { from { opacity: 0; scale: 0.95; } to { opacity: 1; scale: 1; } }
        textarea { resize: none; overflow: hidden; }
        .clickable-link { color: #4f46e5; text-decoration: underline; text-underline-offset: 4px; transition: color 0.2s; word-break: break-all; }
        .clickable-link:hover { color: #3730a3; }
        .sync-badge { position: fixed; bottom: 10px; right: 10px; z-index: 100; font-size: 10px; background: rgba(255,255,255,0.9); padding: 4px 10px; border-radius: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); display: flex; align-items: center; gap: 6px; }
    </style>
</head>
<body>
    <div id="root">
        <div class="flex flex-col items-center justify-center min-h-screen text-slate-400 text-center p-4">
            <div class="animate-spin rounded-full h-10 w-10 border-b-2 border-indigo-600 mb-4"></div>
            <p class="font-bold text-slate-600">æ­£åœ¨å»ºç«‹é›²ç«¯é€£ç·š...</p>
        </div>
    </div>

    <!-- Firebase SDK (Modular) -->
    <script type="importmap">
    {
      "imports": {
        "firebase/app": "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js",
        "firebase/auth": "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js",
        "firebase/firestore": "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js"
      }
    }
    </script>

    <script type="module">
        import { initializeApp } from 'firebase/app';
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from 'firebase/auth';
        import { getFirestore, doc, setDoc, updateDoc, onSnapshot, getDoc } from 'firebase/firestore';
        // å°‡æ¨¡çµ„æ›è¼‰åˆ° window ä¾› Babel è½‰è­¯å¾Œçš„ React ä½¿ç”¨
        window.FirebaseAPI = { initializeApp, getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, getFirestore, doc, setDoc, updateDoc, onSnapshot, getDoc };
    </script>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useCallback } = React;

        // åœ–ç¤ºçµ„ä»¶
        const Icon = ({ name, size = 16, className = "" }) => {
            const icons = {
                MapPin: "ğŸ“", Calendar: "ğŸ“…", ShoppingBag: "ğŸ›ï¸", Train: "ğŸš„",
                Info: "ğŸ“", Check: "âœ…", Copy: "ğŸ“‹", Plus: "â•",
                CloudSnow: "â„ï¸", Navigation: "ğŸ§­", Car: "ğŸš—", Camera: "ğŸ“·",
                Trash: "ğŸ—‘ï¸", Edit: "âœï¸", Save: "ğŸ’¾", Link: "ğŸ”—", List: "ğŸ“œ", Cloud: "â˜ï¸"
            };
            return <span className={`mr-1 ${className}`} style={{fontSize: `${size}px`}}>{icons[name] || "â€¢"}</span>;
        };

        const App = () => {
            const [activeDay, setActiveDay] = useState(1);
            const [copied, setCopied] = useState(false);
            const [showModal, setShowModal] = useState(false);
            const [showExportModal, setShowExportModal] = useState(false);
            const [editingItem, setEditingItem] = useState(null);
            const [modalType, setModalType] = useState('itinerary'); 
            const [formData, setFormData] = useState({ title: '', time: '', note: '', link: '', desc: '' });
            
            const [user, setUser] = useState(null);
            const [isLoading, setIsLoading] = useState(true);
            const [error, setError] = useState(null);
            const [syncStatus, setSyncStatus] = useState('offline');

            const [itineraryDB, setItineraryDB] = useState({});
            const [shoppingDB, setShoppingDB] = useState({});
            const [statusData, setStatusData] = useState({ temp: "2Â°C - 9Â°C", transport: "ICOCA", misc: "é€£ç·šæ­£å¸¸" });
            const [dailyNotes, setDailyNotes] = useState({});

            // ç¢ºä¿ appId çš„ç©©å®šæ€§
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'shared-trip-v2026';

            const defaultItinerary = {
                1: [
                    { id: 'd1-1', time: '08:05', title: 'æ¡ƒåœ’æ©Ÿå ´èµ·é£› (CI156)', note: '5:00 æ´¾è»Šå‡ºç™¼', isDefault: true },
                    { id: 'd1-2', time: '11:35', title: 'æŠµé”é—œè¥¿æ©Ÿå ´ T1', note: 'å¾ C å‡ºå£æ­åˆ©æœ¨æ´¥å·´å£«', isDefault: true }
                ]
            };

            // --- æ ¸å¿ƒï¼šFirebase åˆå§‹åŒ–èˆ‡æ¬Šé™è™•ç† ---
            useEffect(() => {
                let isMounted = true;
                let unsubscribe = null;

                const initSync = async () => {
                    if (!window.FirebaseAPI) return;
                    const { initializeApp, getAuth, signInAnonymously, signInWithCustomToken, getFirestore, doc, onSnapshot, setDoc, getDoc } = window.FirebaseAPI;

                    try {
                        // 1. å–å¾— Firebase é…ç½®
                        const config = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
                        if (!config) {
                            if (isMounted) setError("é›²ç«¯é…ç½®éºå¤±ã€‚");
                            return;
                        }

                        // 2. åˆå§‹åŒ– App
                        const app = initializeApp(config);
                        const auth = getAuth(app);
                        const db = getFirestore(app);

                        // 3. RULE 3: å…ˆé©—è­‰ç™»å…¥
                        const initAuth = async () => {
                            if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                                return await signInWithCustomToken(auth, __initial_auth_token);
                            } else {
                                return await signInAnonymously(auth);
                            }
                        };

                        const authResult = await initAuth();
                        if (isMounted) setUser(authResult.user);

                        // 4. RULE 1: æ­£ç¢ºçš„ 6 æ®µè·¯å¾‘
                        const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'itinerary', 'shared_itinerary');

                        // 5. å•Ÿå‹•å³æ™‚ç›£è½
                        unsubscribe = onSnapshot(docRef, (docSnap) => {
                            if (docSnap.exists()) {
                                const data = docSnap.data();
                                setItineraryDB(data.itinerary || defaultItinerary);
                                setShoppingDB(data.shopping || {});
                                setStatusData(data.status || { temp: "2Â°C - 9Â°C", transport: "ICOCA", misc: "é›²ç«¯å·²åŒæ­¥" });
                                setDailyNotes(data.notes || {});
                                setSyncStatus('online');
                            } else {
                                // åˆå§‹åŒ–é›²ç«¯æ–‡ä»¶
                                setDoc(docRef, {
                                    itinerary: defaultItinerary,
                                    shopping: {},
                                    status: { temp: "2Â°C - 9Â°C", transport: "ICOCA", misc: "åˆå§‹åŒæ­¥æˆåŠŸ" },
                                    notes: {},
                                    lastUpdated: new Date().toISOString()
                                });
                            }
                            if (isMounted) setIsLoading(false);
                        }, (err) => {
                            console.error("Firestore Error:", err);
                            if (isMounted) {
                                setError("æ¬Šé™ä¸è¶³æˆ–é€£ç·šå¤±æ•—ã€‚è«‹ç¢ºèª Firestore è¦å‰‡ã€‚");
                                setSyncStatus('error');
                            }
                        });

                    } catch (e) {
                        console.error("Initialization Failed:", e);
                        if (isMounted) setError("å•Ÿå‹•å¤±æ•—: " + e.message);
                    }
                };

                // ç­‰å¾…æ¨¡çµ„å°±ç·’
                const interval = setInterval(() => {
                    if (window.FirebaseAPI) {
                        initSync();
                        clearInterval(interval);
                    }
                }, 50);

                return () => {
                    isMounted = false;
                    if (unsubscribe) unsubscribe();
                };
            }, [appId]);

            // --- å¯«å…¥é›²ç«¯åŠŸèƒ½ ---
            const saveToCloud = useCallback(async (updates) => {
                if (!user || !window.FirebaseAPI) return;
                setSyncStatus('syncing');
                const { getFirestore, doc, updateDoc } = window.FirebaseAPI;
                const db = getFirestore();
                const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'itinerary', 'shared_itinerary');
                
                try {
                    await updateDoc(docRef, { 
                        ...updates, 
                        lastUpdated: new Date().toISOString() 
                    });
                    setSyncStatus('online');
                } catch (e) {
                    console.error("Cloud Save error:", e);
                    setSyncStatus('error');
                }
            }, [user, appId]);

            // --- è¡Œç¨‹æ’åºèˆ‡å·¥å…· ---
            const getMinutes = (timeStr) => {
                if (!timeStr) return 9999;
                const match = timeStr.match(/(\d{1,2})[:ï¼š](\d{1,2})/);
                return match ? parseInt(match[1]) * 60 + parseInt(match[2]) : 9999;
            };

            const sortedItinerary = useMemo(() => {
                return [...(itineraryDB[activeDay] || [])].sort((a, b) => getMinutes(a.time) - getMinutes(b.time));
            }, [activeDay, itineraryDB]);

            const generateFullText = () => {
                let text = "âœˆï¸ äº¬éƒ½ãƒ»å¤§é˜ªå†¬æ—¥æ—…è¡Œç¨‹ç¸½è¦½ âœˆï¸\n\n";
                for (let d = 1; d <= 7; d++) {
                    const days = ["", "2/8", "2/9", "2/10", "2/11", "2/12", "2/13", "2/14"];
                    text += `ã€Day ${d} | ${days[d]}ã€‘\n`;
                    const dayItin = [...(itineraryDB[d] || [])].sort((a,b) => getMinutes(a.time) - getMinutes(b.time));
                    dayItin.forEach(i => text += `  â° ${i.time || '--:--'} ${i.title}\n`);
                    if (dailyNotes[d]) text += `  ğŸ“ å‚™è¨»: ${dailyNotes[d]}\n`;
                    text += "\n";
                }
                return text;
            };

            const copyFullList = () => {
                const el = document.createElement('textarea');
                el.value = generateFullText();
                document.body.appendChild(el);
                el.select();
                document.execCommand('copy');
                document.body.removeChild(el);
                setCopied(true);
                setTimeout(() => setCopied(false), 2000);
            };

            // --- UI å½ˆçª—è™•ç† ---
            const openModal = (type, item = null) => {
                setModalType(type);
                if (item) {
                    setEditingItem(item);
                    setFormData({ title: item.title || '', time: item.time || '', note: item.note || '', link: item.link || '', desc: item.desc || '' });
                } else {
                    setEditingItem(null);
                    setFormData({ title: '', time: '', note: '', link: '', desc: '' });
                }
                setShowModal(true);
            };

            const handleSaveForm = (e) => {
                e.preventDefault();
                const dbKey = modalType === 'itinerary' ? 'itinerary' : 'shopping';
                const currentData = modalType === 'itinerary' ? itineraryDB : shoppingDB;
                const currentList = currentData[activeDay] || [];
                let newList = editingItem ? currentList.map(item => item.id === editingItem.id ? { ...item, ...formData } : item) : [...currentList, { ...formData, id: Date.now().toString(), isDefault: false }];
                saveToCloud({ [dbKey]: { ...currentData, [activeDay]: newList } });
                setShowModal(false);
            };

            const handleDelete = (id) => {
                if (!confirm('ç¢ºå®šè¦åˆªé™¤å—ï¼Ÿ')) return;
                const dbKey = modalType === 'itinerary' ? 'itinerary' : 'shopping';
                const currentData = modalType === 'itinerary' ? itineraryDB : shoppingDB;
                const updatedList = (currentData[activeDay] || []).filter(item => item.id !== id);
                saveToCloud({ [dbKey]: { ...currentData, [activeDay]: updatedList } });
                setShowModal(false);
            };

            if (error) return <div className="min-h-screen flex items-center justify-center p-8 bg-white text-center text-rose-500 font-bold"><div>âš ï¸ é€£ç·šä¸­æ–·<br/><span className="text-xs font-normal text-slate-400">{error}</span><br/><button onClick={() => location.reload()} className="mt-4 px-6 py-2 bg-indigo-600 text-white rounded-xl">é»æ­¤é‡è©¦</button></div></div>;
            if (isLoading) return <div className="min-h-screen flex flex-col items-center justify-center bg-slate-50"><div className="animate-spin rounded-full h-10 w-10 border-b-2 border-indigo-600 mb-4"></div><p className="text-slate-500 font-bold text-xs uppercase tracking-widest">Shared Database Connecting...</p></div>;

            return (
                <div className="flex flex-col min-h-screen text-slate-800">
                    <div className="sync-badge">
                        <div className={`w-2 h-2 rounded-full ${syncStatus === 'online' ? 'bg-green-500' : syncStatus === 'syncing' ? 'bg-amber-400 animate-pulse' : 'bg-red-500'}`}></div>
                        <span className="text-slate-400 uppercase tracking-tighter">{syncStatus === 'online' ? 'å·²åŒæ­¥' : syncStatus === 'syncing' ? 'æ›´æ–°ä¸­' : 'ä¸­æ–·'}</span>
                    </div>

                    <header className="bg-gradient-header text-white p-6 shadow-xl sticky top-0 z-30">
                        <div className="max-w-4xl mx-auto flex justify-between items-center">
                            <div className="flex items-center gap-3">
                                <Icon name="Cloud" size={24} className="text-indigo-200" />
                                <div>
                                    <h1 className="text-xl md:text-2xl font-bold tracking-tight">äº¬éƒ½ãƒ»å¤§é˜ªå†¬æ—¥æ—…</h1>
                                    <p className="text-indigo-200 text-[10px] uppercase font-bold tracking-widest opacity-60">Real-time Sync Map</p>
                                </div>
                            </div>
                            <button onClick={() => setShowExportModal(true)} className="bg-white text-indigo-900 px-4 py-2 rounded-xl text-xs font-black shadow-lg hover:bg-indigo-50 transition-all flex items-center gap-1">
                                <Icon name="List" /> åŒ¯å‡º
                            </button>
                        </div>
                    </header>

                    <nav className="bg-white border-b sticky top-[80px] md:top-[88px] z-20 overflow-x-auto no-scrollbar shadow-sm">
                        <div className="max-w-4xl mx-auto flex px-4">
                            {[1,2,3,4,5,6,7].map(d => (
                                <button key={d} onClick={() => setActiveDay(d)} className={`flex-none px-6 py-4 text-sm font-black transition-all border-b-4 ${activeDay === d ? 'border-indigo-600 text-indigo-600' : 'border-transparent text-slate-400 hover:text-slate-600'}`}>
                                    Day {d}
                                </button>
                            ))}
                        </div>
                    </nav>

                    <main className="flex-1 max-w-4xl mx-auto w-full p-4 md:p-6 pb-24 space-y-6 fade-in">
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            <div className="lg:col-span-2 space-y-6">
                                <section className="bg-white rounded-3xl shadow-sm border border-slate-200 p-6">
                                    <div className="flex justify-between items-center mb-6">
                                        <h3 className="text-xs font-bold text-slate-400 uppercase tracking-widest flex items-center"><Icon name="Calendar" /> è¡Œç¨‹è·¯ç·š (æ‰‹æ©Ÿ/é›»è…¦åŒæ­¥)</h3>
                                        <button onClick={() => openModal('itinerary')} className="bg-indigo-50 text-indigo-600 px-3 py-1.5 rounded-full text-xs font-bold hover:bg-indigo-100 flex items-center transition-all"><Icon name="Plus" /> æ–°å¢è¡Œç¨‹</button>
                                    </div>
                                    <div className="space-y-6 relative">
                                        {sortedItinerary.map((item, i) => (
                                            <div key={item.id} className="flex gap-4 relative fade-in group cursor-pointer" onClick={() => openModal('itinerary', item)}>
                                                {i !== sortedItinerary.length - 1 && <div className="absolute left-[6px] top-6 w-[2px] h-full bg-slate-100"></div>}
                                                <div className={`${item.isDefault ? 'timeline-dot' : 'timeline-dot-custom'} mt-1.5 flex-shrink-0`}></div>
                                                <div className="flex-1 pb-4">
                                                    <div className="flex flex-col md:flex-row md:justify-between md:items-baseline mb-1">
                                                        <span className={`text-xs font-black ${item.isDefault ? 'text-indigo-500' : 'text-emerald-600'} md:w-16`}>{item.time || 'æœªå®šæ™‚'}</span>
                                                        <div className="flex justify-between items-center flex-1">
                                                            <h4 className="font-bold text-lg">{item.link ? <a href={item.link} target="_blank" rel="noopener noreferrer" className="clickable-link" onClick={(e) => e.stopPropagation()}>{item.title} <Icon name="Link" size={14} className="opacity-60" /></a> : item.title}</h4>
                                                            <div className="opacity-0 group-hover:opacity-100 text-slate-300 text-[10px] font-bold uppercase tracking-tighter">âœï¸ ç·¨è¼¯</div>
                                                        </div>
                                                    </div>
                                                    {item.note && <p className="text-sm p-3 rounded-2xl border bg-slate-50 border-slate-100 mt-2 text-slate-600 leading-relaxed font-medium">{item.note}</p>}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </section>
                                <section className="bg-amber-50 rounded-3xl p-6 border border-amber-200 space-y-3 shadow-sm">
                                    <h4 className="font-bold text-amber-900 text-sm flex items-center"><Icon name="Info" /> ç•¶æ—¥ç§æˆ¿ç­†è¨˜ (é»æ“Šç·¨è¼¯)</h4>
                                    <textarea 
                                        className="w-full bg-transparent border-none focus:ring-0 text-amber-800 text-sm font-medium min-h-[100px]"
                                        placeholder="åœ¨é€™è£¡è¨˜éŒ„ä»Šå¤©çš„ç­†è¨˜..."
                                        value={dailyNotes[activeDay] || ''}
                                        onChange={(e) => {
                                            const newNotes = {...dailyNotes, [activeDay]: e.target.value};
                                            setDailyNotes(newNotes);
                                            saveToCloud({ notes: newNotes });
                                        }}
                                    ></textarea>
                                </section>
                            </div>

                            <div className="space-y-6">
                                <section className="bg-white rounded-3xl shadow-sm p-6 border border-slate-200">
                                    <div className="flex justify-between items-center mb-4">
                                        <div className="flex items-center gap-2 text-rose-500 font-black text-sm uppercase tracking-wider"><Icon name="ShoppingBag" /> å€åŸŸè³¼ç‰©æ¸…å–®</div>
                                        <button onClick={() => openModal('shopping')} className="text-rose-400 hover:text-rose-600"><Icon name="Plus" /></button>
                                    </div>
                                    <div className="space-y-3">
                                        {(shoppingDB[activeDay] || []).map((shop) => (
                                            <div key={shop.id} onClick={() => openModal('shopping', shop)} className="p-4 rounded-2xl border border-slate-100 bg-slate-50 hover:bg-rose-50 cursor-pointer group transition-all">
                                                <div className="font-bold text-slate-800 text-sm flex items-center gap-1">
                                                    {shop.link ? <a href={shop.link} target="_blank" rel="noopener noreferrer" className="clickable-link" onClick={(e) => e.stopPropagation()}>{shop.title} <Icon name="Link" size={12} /></a> : shop.title}
                                                </div>
                                                {shop.desc && <div className="text-[10px] text-slate-400 mt-1 font-medium">{shop.desc}</div>}
                                            </div>
                                        ))}
                                    </div>
                                </section>

                                <section className="bg-slate-900 rounded-3xl p-6 text-white shadow-xl">
                                    <h3 className="font-bold text-[10px] text-indigo-300 uppercase tracking-widest mb-5 text-center tracking-widest">å¯¦æ™‚åŒæ­¥å„€è¡¨æ¿</h3>
                                    <div className="space-y-5">
                                        {['temp', 'transport', 'misc'].map(key => (
                                            <div key={key} className="flex items-center gap-4 group">
                                                <div className="text-2xl bg-white/10 p-2 rounded-xl font-bold">{key === 'temp' ? 'ğŸŒ¡ï¸' : key === 'transport' ? 'ğŸš„' : 'ğŸ“Œ'}</div>
                                                <div className="flex-1">
                                                    <div className="text-[10px] opacity-50 font-bold uppercase tracking-tighter">{key === 'temp' ? 'æ°£æº«é å ±' : key === 'transport' ? 'äº¤é€šå·¥å…·' : 'æé†’äº‹é …'}</div>
                                                    <input 
                                                        className="w-full bg-transparent border-none p-0 text-sm font-black focus:ring-0 text-white" 
                                                        value={statusData[key] || ''} 
                                                        onChange={(e) => {
                                                            const newStatus = {...statusData, [key]: e.target.value};
                                                            setStatusData(newStatus);
                                                            saveToCloud({ status: newStatus });
                                                        }} 
                                                    />
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </section>
                            </div>
                        </div>
                    </main>

                    {showModal && (
                        <div className="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                            <div className="bg-white rounded-3xl p-6 w-full max-w-sm shadow-2xl scale-in">
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="text-xl font-bold flex items-center"><Icon name={editingItem ? "Edit" : "Plus"} /> {editingItem ? 'ç·¨è¼¯' : 'æ–°å¢'}å…§å®¹</h3>
                                    {editingItem && <button onClick={() => handleDelete(editingItem.id)} className="text-slate-300 hover:text-red-500"><Icon name="Trash" size={20} /></button>}
                                </div>
                                <form onSubmit={handleSaveForm} className="space-y-4">
                                    {modalType === 'itinerary' && <div><label className="text-[10px] font-bold text-slate-400 uppercase ml-1 tracking-widest">æ™‚é–“ (ä¾‹å¦‚ 09:30)</label><input type="text" value={formData.time} placeholder="14:30" onChange={e => setFormData({...formData, time: e.target.value})} className="w-full p-3 bg-slate-50 border border-slate-100 rounded-2xl text-sm focus:ring-2 focus:ring-indigo-500 outline-none" /></div>}
                                    <div><label className="text-[10px] font-bold text-slate-400 uppercase ml-1 tracking-widest">æ¨™é¡Œåç¨±</label><input type="text" value={formData.title} placeholder="è¦å»å“ªè£¡ï¼Ÿ" onChange={e => setFormData({...formData, title: e.target.value})} className="w-full p-3 bg-slate-50 border border-slate-100 rounded-2xl text-sm focus:ring-2 focus:ring-indigo-500 outline-none" required /></div>
                                    <div><label className="text-[10px] font-bold text-slate-400 uppercase ml-1 tracking-widest">é€£çµç¶²å€ (URL)</label><input type="url" value={formData.link} placeholder="https://..." onChange={e => setFormData({...formData, link: e.target.value})} className="w-full p-3 bg-slate-50 border border-slate-100 rounded-2xl text-sm focus:ring-2 focus:ring-indigo-500 outline-none" /></div>
                                    <div><label className="text-[10px] font-bold text-slate-400 uppercase ml-1 tracking-widest">è£œå……èªªæ˜</label><input type="text" value={formData.note || formData.desc} placeholder="è£œå……èªªæ˜..." onChange={e => setFormData({...formData, note: e.target.value, desc: e.target.value})} className="w-full p-3 bg-slate-50 border border-slate-100 rounded-2xl text-sm focus:ring-2 focus:ring-indigo-500 outline-none" /></div>
                                    <div className="flex gap-2 pt-2"><button type="button" onClick={() => setShowModal(false)} className="flex-1 p-3 font-bold text-slate-500">å–æ¶ˆ</button><button type="submit" className={`flex-1 p-3 text-white font-bold rounded-2xl shadow-lg transition-all ${modalType === 'itinerary' ? 'bg-indigo-600 hover:bg-indigo-700 shadow-indigo-100' : 'bg-rose-500 hover:bg-rose-600 shadow-rose-200'}`}>åŒæ­¥ä¸¦å„²å­˜</button></div>
                                </form>
                            </div>
                        </div>
                    )}

                    {showExportModal && (
                        <div className="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                            <div className="bg-white rounded-3xl w-full max-w-2xl max-h-[90vh] shadow-2xl scale-in overflow-hidden flex flex-col">
                                <div className="p-6 border-b flex justify-between items-center bg-slate-50">
                                    <h3 className="text-xl font-bold">å…¨è¡Œç¨‹å½™æ•´</h3>
                                    <button onClick={() => setShowExportModal(false)} className="text-slate-400 text-2xl font-bold">&times;</button>
                                </div>
                                <div className="flex-1 p-6 overflow-y-auto whitespace-pre-wrap font-mono text-sm leading-relaxed bg-white">{generateFullText()}</div>
                                <div className="p-6 border-t bg-slate-50 flex gap-3"><button onClick={copyFullList} className={`flex-1 p-3 rounded-2xl font-bold transition-all ${copied ? 'bg-emerald-500' : 'bg-indigo-600'} text-white shadow-lg`}>{copied ? 'âœ… å·²æˆåŠŸè¤‡è£½ï¼' : 'ğŸ“‹ ä¸€éµè¤‡è£½æ–‡å­—è¡Œç¨‹'}</button></div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
